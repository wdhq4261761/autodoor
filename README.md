# AutoDoor OCR 识别系统

一个自动化的OCR文字识别系统，用于监控屏幕特定区域并执行相应操作。

## 功能特性

- ✅ 支持多显示器区域选择
- ✅ 可自定义OCR识别间隔（1-30秒）
- ✅ 支持中英文识别切换（英文/简体中文/繁体中文）
- ✅ 自动化鼠标点击和键盘操作
- ✅ 实时状态显示和日志记录
- ✅ 配置自动保存/加载
- ✅ Windows/macOS平台打包支持
- ✅ 多标签页界面布局（文字识别、定时功能、数字识别、基本设置、日志）
- ✅ 定时功能：支持3个独立定时组，可设置不同按键和间隔
- ✅ 数字识别功能：支持2个独立区域，可设置阈值和触发按键
- ✅ 报警功能：支持自定义报警声音和音量调节
- ✅ 模块独立配置：每个功能模块都有独立的配置和开关
- ✅ 按键延迟配置：支持设置按键按下的最小和最大延迟
- ✅ 每个模块独立的报警开关控制
- ✅ 全局报警声音和音量设置

## 使用教程
B 站：[https://www.bilibili.com/video/BV1AGiGB8EYN](https://www.bilibili.com/video/BV1AGiGB8EYN)

## 安装要求

### 方法一：直接运行打包好的可执行文件（推荐）

#### Windows系统：
1. 从发布页面下载`autodoor-windows.zip`文件
2. 解压到任意目录
3. 运行`autodoor.exe`文件

#### macOS系统：
1. 从发布页面下载`autodoor-macos.zip`文件
2. 解压到任意目录
3. 运行`autodoor`可执行文件

### 方法二：从源码运行

#### 1. Python环境
- Python 3.8+ 版本

#### 2. 安装Python依赖

```bash
# 创建虚拟环境（推荐）
python -m venv venv

# 激活虚拟环境
# Windows:
venv\Scripts\activate
# Linux/macOS:
source venv/bin/activate

# 安装依赖
pip install -r requirements.txt
```

#### 3. Tesseract OCR引擎（可选）

系统会优先使用内置的Tesseract引擎，也可以使用外部安装的Tesseract：

##### Windows系统：
1. 下载Tesseract安装包：[Tesseract OCR](https://github.com/UB-Mannheim/tesseract/wiki)
2. 安装时记住安装路径

##### Linux系统：
```bash
sudo apt-get install tesseract-ocr
```

##### macOS系统：
```bash
brew install tesseract
```

## 使用方法

### 从源码运行
```bash
python autodoor.py
```

### 从可执行文件运行
- Windows：双击`autodoor.exe`文件
- macOS：双击`autodoor`可执行文件

## 界面功能说明

### 文字识别标签页

1. **区域选择**
   - 点击"选择区域"按钮，拖动鼠标选择要监控的屏幕区域
   - 显示当前选择的区域坐标

2. **识别设置**
   - **识别间隔**：设置OCR识别的时间间隔（1-30秒）
   - **暂停时长**：检测到关键词后的暂停时间（30-300秒）
   - **触发按键**：检测到关键词后自动按下的按键
   - **按键时长**：设置按键按下的最小和最大延迟（毫秒）
   - **启用报警**：开关，用于控制检测到关键词时是否播放报警声音

3. **关键词和语言设置**
   - **识别关键词**：输入多个关键词，用英文逗号分隔
   - **OCR识别语言**：选择识别语言（英文、简体中文、繁体中文）
   - 支持保存关键词和恢复默认设置

### 定时功能标签页

1. **定时组配置**
   - 支持3个独立的定时组，可分别启用/禁用
   - 每个定时组可设置：
     - **间隔**：定时执行的时间间隔（秒）
     - **按键**：要按下的按键
     - **按键时长**：按键按下的最小和最大延迟（毫秒）
     - **启用报警**：执行按键时是否播放报警声音

2. **操作按钮**
   - **开始定时任务**：启动所有启用的定时组
   - **停止定时任务**：停止所有定时组

### 数字识别标签页

1. **区域配置**
   - 支持2个独立的数字识别区域，可分别启用/禁用
   - 每个区域可设置：
     - **选择区域**：选择要监控的数字区域
     - **阈值**：触发按键的数字阈值
     - **按键**：达到阈值时要按下的按键
     - **按键时长**：按键按下的最小和最大延迟（毫秒）
     - **启用报警**：达到阈值时是否播放报警声音

2. **操作按钮**
   - **开始数字识别**：启动数字识别监控
   - **停止数字识别**：停止数字识别

### 基本设置标签页

1. **Tesseract配置**
   - 显示当前Tesseract路径
   - 可手动设置Tesseract路径

2. **坐标模式设置**
   - **区域中心**：点击选择区域的中心位置
   - **自定义坐标**：设置相对于选择区域左上角的自定义坐标
   - 自定义坐标输入框

3. **报警声音设置**
   - **报警声音**：选择自定义报警声音文件
   - **音量调节**：滑动条控制报警音量（0-100%）

4. **配置管理**
   - **保存配置**：手动保存当前配置
   - **重置配置**：恢复默认配置

### 日志标签页

- 显示程序运行的实时日志
- 包含时间戳和详细的操作记录
- 支持清除日志

### 控制按钮

- **选择区域**：开始选择要监控的屏幕区域（仅文字识别标签页）
- **开始监控**：开始OCR识别和监控（仅文字识别标签页）
- **停止监控**：停止监控（仅文字识别标签页）
- **退出程序**：退出应用

## 操作流程

### 文字识别操作流程

1. 运行程序
2. 切换到"文字识别"标签页
3. 点击"选择区域"按钮，拖动鼠标选择要监控的屏幕区域
4. 调整识别设置：
   - 设置识别间隔和暂停时长
   - 选择触发按键和按键时长
   - 根据需要启用报警
5. 设置关键词和语言：
   - 输入要识别的关键词
   - 选择合适的识别语言
   - 点击"保存关键词"
6. 点击"开始监控"按钮开始OCR识别
7. 当检测到关键词时，系统会自动执行：
   - 点击指定位置（区域中心或自定义坐标）
   - 按下指定按键（持续时间在设置的范围内随机）
   - 如果启用了报警，播放报警声音
   - 暂停设定的时长后继续监控
8. 点击"停止监控"按钮可停止识别

### 定时功能操作流程

1. 切换到"定时功能"标签页
2. 选择要配置的定时组
3. 勾选"启用"开关
4. 设置定时间隔和要按下的按键
5. 调整按键时长（可选）
6. 根据需要启用报警
7. 重复以上步骤配置其他定时组
8. 点击"开始定时任务"启动所有启用的定时组
9. 点击"停止定时任务"可停止所有定时组

### 数字识别操作流程

1. 切换到"数字识别"标签页
2. 选择要配置的数字区域
3. 勾选"启用"开关
4. 点击"选择区域"按钮，选择要监控的数字区域
5. 设置触发阈值和要按下的按键
6. 调整按键时长（可选）
7. 根据需要启用报警
8. 重复以上步骤配置另一个数字区域（可选）
9. 点击"开始数字识别"启动数字识别监控
10. 当检测到数字达到或超过阈值时，系统会：
    - 按下指定按键
    - 如果启用了报警，播放报警声音
11. 点击"停止数字识别"可停止数字识别监控

## 配置文件说明

程序会自动生成和加载配置文件`autodoor_config.json`，包含以下配置项：

### 基本配置
- `version`：配置文件版本号
- `last_save_time`：上次保存配置的时间

### OCR文字识别配置
- `ocr`：文字识别相关配置
  - `interval`：OCR识别间隔（秒）
  - `pause_duration`：暂停时长（秒）
  - `selected_region`：选择的监控区域坐标
  - `custom_key`：自定义按键
  - `custom_keywords`：自定义关键词列表
  - `language`：OCR识别语言
  - `delay_min`：按键按下的最小延迟（毫秒）
  - `delay_max`：按键按下的最大延迟（毫秒）

### 点击模式配置
- `click`：点击模式相关配置
  - `mode`：点击模式（center/custom）
  - `x`：自定义X坐标
  - `y`：自定义Y坐标

### 定时功能配置
- `timed_key_press`：定时功能相关配置
  - `groups`：定时组列表
    - `enabled`：是否启用该定时组
    - `interval`：定时间隔（秒）
    - `key`：要按下的按键
    - `delay_min`：按键按下的最小延迟（毫秒）
    - `delay_max`：按键按下的最大延迟（毫秒）

### 数字识别配置
- `number_recognition`：数字识别相关配置
  - `regions`：数字识别区域列表
    - `enabled`：是否启用该区域
    - `region`：选择的数字区域坐标
    - `threshold`：触发阈值
    - `key`：要按下的按键
    - `delay_min`：按键按下的最小延迟（毫秒）
    - `delay_max`：按键按下的最大延迟（毫秒）

### 报警配置
- `alarm`：报警相关配置
  - `sound`：报警声音文件路径
  - `volume`：报警音量（0-100）
  - `ocr`：文字识别模块报警开关
  - `timed`：定时功能模块报警开关
  - `number`：数字识别模块报警开关

### Tesseract配置
- `tesseract`：Tesseract OCR引擎配置
  - `path`：Tesseract OCR引擎路径

## 日志文件

程序会生成日志文件`autodoor.log`，包含：
- 程序启动和退出记录
- 配置加载和保存记录
- Tesseract检测结果
- OCR识别结果
- 操作执行记录
- 错误和异常信息

## 打包说明

### Windows平台打包
使用批处理脚本进行打包：
```cmd
./build_windows.bat
```

### macOS平台打包
使用Shell脚本进行打包：
```bash
./build_mac.sh
```

打包后的可执行文件位于`dist/autodoor/`目录下，包含所有必要的依赖文件和内置的Tesseract引擎。

## 注意事项

1. 选择的监控区域应包含清晰可见的文字
2. 运行脚本时请确保目标区域保持可见
3. Windows系统可能需要管理员权限才能正常模拟鼠标和键盘操作
4. macOS系统可能需要在"安全性与隐私"中允许程序控制电脑
5. 程序会自动检测和使用内置的Tesseract引擎，无需额外安装

## 故障排除

### 问题：Tesseract未检测到
- 检查配置文件中的Tesseract路径是否正确
- 程序会自动尝试使用内置的Tesseract引擎

### 问题：OCR识别结果为空
- 检查选择的区域是否包含清晰的文字
- 尝试调整选择区域大小
- 尝试切换识别语言

### 问题：无法模拟鼠标/键盘操作
- Windows：尝试以管理员身份运行程序
- macOS：检查"安全性与隐私"设置，允许程序控制电脑
- 检查是否有其他软件阻止了自动化操作

### 问题：程序崩溃
- 检查Python版本是否符合要求（3.8+）
- 查看日志文件`autodoor.log`中的错误信息
- 重新安装依赖包：`pip install -r requirements.txt`

## 开发说明

### 项目结构

```
autodoor/
├── autodoor.py          # 主程序文件
├── autodoor_config.json # 配置文件
├── autodoor.log         # 日志文件
├── autodoor.spec        # PyInstaller配置文件
├── build_windows.bat    # Windows打包脚本
├── build_mac.sh         # macOS打包脚本
├── requirements.txt     # Python依赖
├── README.md            # 说明文档
└── tesseract/           # 内置Tesseract引擎目录
    └── ...
```

### 依赖包

- pyautogui >= 0.9.54
- pytesseract >= 0.3.10
- Pillow >= 10.0.0
- opencv-python >= 4.8.0
- numpy >= 1.24.0
- screeninfo >= 0.8.1
- pyinstaller (用于打包)

## 许可证

MIT License